# Инструкция по настройке reCAPTCHA

## Где получить ключи reCAPTCHA

### Шаг 1: Перейдите на сайт Google reCAPTCHA
1. Откройте https://www.google.com/recaptcha/admin/create
2. Войдите в свой Google аккаунт

### Шаг 2: Создайте новый сайт
1. Нажмите кнопку **"+"** (добавить новый сайт)
2. Заполните форму:
   - **Метка**: Дом Пивовара (или любое другое название)
   - **Тип reCAPTCHA**: выберите **reCAPTCHA v2** → **"Я не робот"**
   - **Домены**: добавьте ваши домены:
     - `localhost` (для разработки)
     - `127.0.0.1` (для разработки)
     - Ваш реальный домен (например: `dompivovara.ru`)
     - `*.dompivovara.ru` (для поддоменов, если нужно)
   - Примите условия использования
   - Нажмите **"Отправить"**

### Шаг 3: Получите ключи
После создания сайта вы получите:
- **Ключ сайта (Site Key)** - это публичный ключ для клиента
- **Секретный ключ (Secret Key)** - это секретный ключ для сервера

## Настройка в проекте

### Шаг 1: Добавьте ключи в .env файл

Откройте файл `.env` в корне проекта и добавьте:

```env
# reCAPTCHA
NEXT_PUBLIC_RECAPTCHA_SITE_KEY="ваш-ключ-сайта-здесь"
RECAPTCHA_SECRET_KEY="ваш-секретный-ключ-здесь"
```

**ВАЖНО:**
- Не используйте кавычки внутри кавычек
- Не добавляйте пробелы вокруг знака `=`
- Убедитесь, что ключи скопированы полностью, без лишних пробелов

**Правильный формат:**
```env
NEXT_PUBLIC_RECAPTCHA_SITE_KEY="6LcfEEUsAAAAADoHXWD0mHMF_wkl0egAYNLWvG9K"
RECAPTCHA_SECRET_KEY="6LcfEEUsAAAAAHYXWSWZ23ChS0tVkppjzPPY4Zo4"
```

**Неправильный формат:**
```env
# ❌ Неправильно - лишние пробелы
NEXT_PUBLIC_RECAPTCHA_SITE_KEY = "6LcfEEUsAAAAADoHXWD0mHMF_wkl0egAYNLWvG9K"

# ❌ Неправильно - кавычки внутри кавычек
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=""6LcfEEUsAAAAADoHXWD0mHMF_wkl0egAYNLWvG9K""

# ❌ Неправильно - без кавычек (может не работать если есть спецсимволы)
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=6LcfEEUsAAAAADoHXWD0mHMF_wkl0egAYNLWvG9K
```

### Шаг 2: Перезапустите сервер разработки

**ОБЯЗАТЕЛЬНО** перезапустите dev-сервер после изменения .env файла:

1. Остановите текущий сервер (Ctrl+C)
2. Запустите снова:
   ```bash
   npm run dev
   ```

### Шаг 3: Проверьте работу

1. Откройте форму регистрации или входа
2. Должна появиться капча reCAPTCHA
3. Отметьте "Я не робот"
4. Попробуйте зарегистрироваться или войти

## Решение проблем

### Ошибка: "неверный ключ"

**Причины:**
1. Ключи не соответствуют домену - убедитесь, что в настройках reCAPTCHA добавлен правильный домен
2. Неверный формат в .env файле
3. Сервер не перезапущен после изменения .env
4. Ключи скопированы не полностью

**Решение:**
1. Проверьте формат в .env файле (см. выше)
2. Убедитесь, что домен в настройках reCAPTCHA совпадает с вашим доменом
3. Перезапустите сервер
4. Проверьте консоль браузера и сервера на наличие ошибок

### Ошибка: "reCAPTCHA не настроена на сервере"

**Причина:** Переменная окружения не найдена

**Решение:**
1. Проверьте, что файл называется `.env` (не `.env.example`)
2. Убедитесь, что переменные добавлены в правильном формате
3. Перезапустите сервер

### Капча не отображается

**Причина:** NEXT_PUBLIC_RECAPTCHA_SITE_KEY не установлен или неверный

**Решение:**
1. Проверьте значение `NEXT_PUBLIC_RECAPTCHA_SITE_KEY` в .env
2. Откройте консоль браузера (F12) и проверьте ошибки
3. Убедитесь, что сервер перезапущен

## Проверка ключей

Вы можете проверить, правильно ли настроены ключи:

1. Откройте консоль браузера (F12)
2. Введите: `console.log(process.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY)`
3. Должен отобразиться ваш ключ сайта

Если отображается `undefined`, значит:
- Переменная не загружена
- Сервер не перезапущен
- Неверное имя переменной

## Для продакшена

При деплое на продакшн:
1. Добавьте ключи в переменные окружения хостинга
2. Убедитесь, что в настройках reCAPTCHA добавлен ваш продакшн домен
3. Перезапустите приложение

