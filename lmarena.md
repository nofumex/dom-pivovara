я предоставлю тебе скриншоты сайта и содержимое двух файлов - frontend_prompt.md и backend_prompt.md, фронтенд промпт трогать не надо он и так верный а бэкенд промпт написан по содержимому другого сайта
твоя задача - написать production_prompt который будет целиком и полностью содержать весь frontend_prompt а так же  backend_prompt измененный в соответствии с фронтендом то есть на выходе после отработки всего промпта нейросетью (Cursor) на выходе должен получиться готовый полностью production-ready сайт с регистрацией и админ-панелью полностью функциональной 

самое главное - чтобы после отработки промпта все действительно было полностью функционально а не просто кнопки которые как бы есть но при нажатии ничего не делают или админка в которой как бы можно редактировать но на деле ничего не меняется на сайте а надо чтобы все работало менялось и показывалось 


frontend_prompt.md:
Ты — senior фронтенд‑разработчик. Сгенерируй полноценный, максимально точный (1-в-1) клон десктопной версии сайта «Дом Пивовара» по нижеследующему подробному ТЗ, не имея исходных картинок. Реализуй только UI и базовую клиентскую логику (без бэкенда), но так, чтобы всё выглядело и работало как на реальном сайте.

Технологический стек и общие требования
Next.js 14 + TypeScript + App Router.
SCSS Modules (предпочтительно) или TailwindCSS с кастомной темой. Если Tailwind — подключи CSS variables для токенов.
Иконки — встроенные SVG (Tabler/Feather как база, при необходимости дорисуй простые SVG).
Изображения заменяй на заглушки с похожими композициями (градиенты, иллюстративные формы), размеры и пропорции строго соблюдай.
Макет пиксель‑перфект: разметка, межстрочные интервалы, отступы, размеры элементов, толщина границ, радиусы, тени — строго по ТЗ.
Шрифты: основной — Inter (или Roboto), fallback: Arial, sans-serif.
Семантика и доступность: <header>, <nav>, <main>, <aside>, <section>, <footer>, aria‑label, aria‑expanded, aria‑current, alt‑тексты, фокус‑стили.
Локализация: весь текст на русском, валюту показывать «₽/шт».
SEO: теги title/meta/og, микроразметка schema.org для BreadcrumbList и Product на карточке.
Файловая структура:
/app
/(public)/ (страницы: главная, каталог, категория, товар и пр.)
/components (атомы/молекулы/организмы)
/data (моки .ts)
/styles (globals.scss, variables.scss)
/icons (SVG)
Роутинг (SPA с SSR отключать не нужно):
/ — главная
/catalog — разделы каталога
/catalog/[slug] — категория
/catalog/[slug]/[subslug] — подкатегория (листинг)
/product/[slug] — карточка товара
/stores, /about, /articles, /delivery, /contacts, /sales, /help, /faq, /news, /search
Состояния: hover, active, focus, disabled, loading для интерактивных контролов.
Брейкпоинты (desktop‑first, реализуй и responsive):
≥1366px: десктоп основной
1024–1365: компактный десктоп
768–1023: планшет (левое меню сворачивается в off‑canvas)
<768: мобильный (вторично)
Дизайн‑токены (точные значения)
Цвета:
--color-primary-600: #F57C00 (основной оранжевый — шапка, кнопки)
--color-primary-700: #E66A00 (hover для кнопок/активных ссылок)
--color-primary-500: #FF8A00 (ряд декоративных элементов)
--color-accent-blue: #2A84D2 (бейдж «Хиты продаж»)
--color-success: #2E7D32 (статус «Достаточно», галочка)
--color-warning: #EF6C00 (статус «Мало»)
--color-danger: #E53935 (статус «Нет в наличии»)
--color-star: #F5A623 (звёзды рейтинга)
--color-text: #333333
--color-muted: #666666
--color-border: #E6E6E6
--color-bg: #F5F6F7 (фон блоков/страниц)
--color-white: #FFFFFF
--color-link: #1A73E8
Тени и радиусы:
--radius-sm: 3px
--radius-md: 6px
--radius-lg: 10px
--shadow-card: 0 1px 2px rgba(0,0,0,0.06)
--shadow-elev: 0 4px 16px rgba(0,0,0,0.08)
Типографика:
Заголовок H1: 42px/1.2, 700
H2: 26px/1.25, 700
H3: 20px/1.3, 700
Текст базовый: 16px/1.5, 400
Малый: 14px/1.4, 400
Кнопка: 15px/1.2, 600
Контейнер и сетка:
max-width контейнера: 1200px (по центру)
Левый сайдбар каталога: 270px
Межколоночный отступ карточек: 24px
Сетка карточек товаров: 4 в ряд на ≥1366px; 3 — на 1024–1365; 2 — на 768–1023; 1 — на <768
Иконки (SVG, монохром, текущийColor)
Логотип слева — круглая пивная крышка с бочкой — заменить на круглый плейсхолдер «ЛОГО» (оранжевый круг с белой бочкой-иконкой).
Иконки: телефон, корзина, сердце, сравнение (столбики/бар‑чарт), пользователь, гамбургер, стрелка, часы, авто‑доставка, сертификат, подарок, стрелка «вверх».
Бейджи: «Хиты продаж», «Новинка», «По акции» — как закладка в верхнем левом углу карточки.
Шапка и верхняя навигация
4.1. Верхняя линия шапки (высота 96px)
Слева: круглый логотип 72×72, справа от него текстовый логотип «Дом Пивовара» (H2, 700).
По центру: поиск — инпут 540×42, placeholder «Поиск по товарам», справа внутри — кнопка‑лупа 42×42 (иконка).
Справа: блок телефонов:
Иконка телефона в оранжевом кружке 40×40.
Две строки телефонов (полужирные): «+7 913 555-222-6» и «+7 913 037-32-47».
Под ними линк малым кеглем «ЗАКАЗАТЬ ЗВОНОК» (в верхнем регистре, цвет — primary‑600, hover — primary‑700). По клику — модалка «Заказать звонок» (см. раздел Модалки).
Паддинги шапки по бокам: 24px; фон — белый; нижняя граница 1px цветом --color-border.
4.2. Горизонтальное меню (высота 54px, фон — --color-primary-600, текст белый, все caps)
Элементы по центру контейнера:

«Каталог» слева с иконкой «гамбургер» и маленькой стрелкой вниз. При наведении — не меняется фон, при клике — открывает/закрывает левый сайдбар, а также подсвечивает (фон — primary‑700).
Далее пункты: «О КОМПАНИИ», «АКЦИИ», «МАГАЗИНЫ», «СТАТЬИ», «ДОСТАВКА И ОПЛАТА», «КОНТАКТЫ».
Активный пункт подсвечивается подчеркиванием 3px белой полосой снизу.
4.3. Правый плавающий сайдбар (фиксированный, по центру окна справа, 52px шириной, фон — тёмно‑серые кнопки)
Стек вертикально, между ними 12px:

Кнопка «Корзина» (иконка тележки), «Избранное» (сердце), «Сравнение» (бар‑чарт), «Профиль» (юзер). Кнопки 44×44, закругление 8px, фон #3A4148, иконка белая 22px. Hover — фон #48525B. Показывать счётчики (крошечные оранжевые бейджи, top‑right).
По клику:
Корзина — сайд‑дроуэр справа 420px с содержимым, итогом, кнопкой «Оформить».
Избранное — сайд‑дроуэр с карточками.
Сравнение — сайд‑дроуэр; ограничить до 4 товаров; кнопка «Сравнить».
Профиль — модалка логина (email/телефон + код/пароль), без фактической авторизации.
4.4. Кнопка «Наверх»

Круглая оранжевая 48×48 с белой стрелкой, fixed bottom‑right 24×24 отступы, появляется после прокрутки >600px, smooth scroll.
Левое вертикальное меню «Каталог» (сайдбар)
Ширина 270px, фон — белый, граница справа 1px.
Заголовок шапки сайдбара (оранжевая полоса как в верхнем меню) с иконкой «гамбургер» и текстом «КАТАЛОГ».
Список категорий (каждая строка 44px, разделитель 1px --color-border, справа стрелка «>», hover — фон #FFF5EB):
Пивоварение
Самогоноварение
Виноделие
Шланги, соединения
Тара и ёмкости
Бондарные изделия
Кастрюли/печи: «Казаны, тандыры, мангалы, печи, посуда»
Всё для изготовления колбас
Сыроделие
Измерительное оборудование
Автоклавы и коптильни
Хлеб и квас
Травы и специи
Литература
Мегаменю: при наведении на пункт (в основном — «Самогоноварение») справа в основной зоне всплывает панель 860px шириной, высота по контенту, с 3–4 колонками. Пример «Самогоноварение»:
Колонка 1: «Самогонные аппараты» (жирный), подэлементы:
Оборудование «Самогон и водка»
Самогонные аппараты Вейн (Wein)
Оборудование компании «Добровар»
Оборудование Люксталь LUXSTAHL
Оборудование компании «Аквавит»
Аппараты Domspirt
Колонка 2: «Комплектующие»:
Царги, хомуты и переходники
Прокладки
Вспомогательное оборудование
Котлы, хомуты, крышки
Колонка 3: «Доп. компоненты»:
Очистка
Ферменты, соли, кислоты
Осветлители, пеногасители
Для цвета, вкуса, аромата
Бонификаторы
Колонка 4:
«Автоматика»: Системы углевания; Автоматика и комплектующие
«Спиртовые дрожжи»: Спиртовые и подкормка; Фруктовые, мёд; Ром; Виски, бурбон
«Солодовые экстракты»
«Индукционные плиты и тэны»
«Настойки и травы, эссенции»: Сибирская Винокурия; Алтайский Винокур; Алхимия вкуса
«Сувениры и книги»
В каждой подкатегории слева маленькая иконка/мини‑превью 24×24 (плейсхолдер), заголовки разделов — полужирные, ссылки — обычные; hover ссылки — цвет primary‑600.
Главная страница (/)
6.1. Хиро‑слайдер
Область 100% контейнера, высота 360px, нижний отступ 24px.
Слайд 1: фон градиент розово‑фиолетовый (похож на скрин), справа крупный знак «π%» стилизуем вектором, слева белая коробка‑подарок (плейсхолдер формы). Текст белый:
Заголовок: «Скидки»
Кнопка: «Узнать больше о скидках» (оранжевая, прямоугольная, 160×40, радиус 4px, hover — тёмнее).
Точки‑индикаторы снизу по центру (5 шт.), активная — белая, остальные полупрозрачные. Автопрокрутка 5с, остановка по hover, стрелки навигации по бокам (скрытые до hover).
6.2. Полоса преимуществ (4 пункта, под слайдером)
Иконки 32×32 слева, текст справа:
«Подарочные сертификаты»
«Весь товар сертифицирован»
«30 дней на обмен и возврат»
«Удобная и быстрая доставка»
Равные колонки, фон белый, тень карточная.
6.3. Превью категорий (плитки‑баннеры)
Сетка 2 ряда.
Верхний ряд: большая левая плитка «Пивоварение» (фото колосьев — заменяем на градиент/иллюстрацию), справа две квадратные: «Самогоноварение», «Виноделие».
Нижний ряд: слева «Казаны, мангалы, печи, посуда», по центру широкая «Бондарные изделия», справа «Сыроделие».
На каждой плитке — оранжевая лента/ярлык с названием белыми буквами в левом нижнем углу. По клику — переход в соответствующую категорию.
6.4. Левая колонка бокса (под сайдбаром)
Блок «Будьте всегда в курсе!» (подписка): заголовок, подзаголовок «Узнавайте о скидках и акциях первыми», инпут email с placeholder «Ваш e-mail», кнопка‑стрелка оранжевая 40×40 справа внутри инпута. Валидация email (только фронт).
«Новости»: список, элемент — дата «19 апреля 2022» + ссылка «Новый сайт Дома Пивовара»; ссылка «Все новости».
«Статьи»: список карточек с круглыми превью 48×48, заголовки: «ЯрФест 2023!», «Процесс приготовления пива», «Светлое пиво: Венское». Ссылка «Все статьи».
6.5. Табы товаров (хиты/новинки/по акции)
Заголовок слева «Хиты продаж», справа табы «Новинки», «По акции» (не подчёркнутые, активный — оранжевая полоска снизу 3px).
Карточка товара:
Верхний левый бейдж (синий) «Хиты продаж»/«Новинка»/«По акции».
Изображение 1:1, 260×260 в сетке на 4 колонки.
Название товара (2 строки максимум, ellipsis).
Рейтинг (5 серых звёзд, часть — золотые, как в мок‑данных).
Статус наличия: зелёная галочка и текст «Достаточно» / «Много», «Мало» (оранж), «Нет в наличии» (серо‑красный, без галочки).
Цена жирная «NNN ₽/шт».
По hover карточки — лёгкая тень, отображать кнопку «В корзину» (оранжевая 120×36) и «В избранное» (иконка сердца).
Межкарточный отступ 24px, рамка 1px --color-border, радиус 6px, паддинги 16px.
6.6. Блок «О Доме Пивовара»

Слева круглая фото‑заглушка «курьер» 200×200.
Справа заголовок «О Доме Пивовара» и параграф (текст из скрина, общий про интернет‑магазин). Кнопка «Подробнее» (оранжевая, outline).
Ниже — полоса логотипов партнёров (серые/полупрозрачные).
Страница «Каталог» (/catalog)
Заголовок H1: «Каталог».
Сетка 2 колонки карточек‑разделов (каждая — белая карточка с тенью, изображение слева 140×100, справа заголовок оранжевым и список подкатегорий с количествами).
Примеры карточек:
«Пивоварение» — подсписки: Пивоварни и ЦКТ 9; Ингредиенты 152; Брожение и розлив 52; Пивные наборы и медовуха 40; Сидр и медовуха 6; Дополнительное оборудование 33.
«Самогоноварение» — Самогонные аппараты 48; Доп. компоненты 31; Автоматика 17; Комплектующие 172; Спиртовые дрожжи 40; Солодовые экстракты 11; Настойки и травы, эссенции 288; Индукционные плиты и тэны 12; Сок концентрированный 46; Сувениры и книги 3.
«Шланги, соединения» — Силиконовые трубки 12; ПВХ‑трубки 16; Краны, штуцеры 52.
И т. д. по скринам.
По клику на раздел — переход в /catalog/[slug].
Страница категории/подкатегории (листинг)
Верхняя панель: хлебные крошки: «Главная — Каталог — [Категория] — [Подкатегория]».
Слева фильтры (над сеткой товаров, ширина 100% контента категории; в скрине фильтры в верхней части правой колонки):
Слайдер цены (двухползунковый). Поля ввода минимальной/максимальной цены синхронизированы с ползунками. Правее над слайдером показывать текущие значения (например, «3 390 — 57 990»).
Чекбоксы «Наши предложения»: «По акции (1)». Можно добавить «Новинки» для полноты.
Кнопки: «Показать» (primary) и «Сбросить» (link).
Панель сортировки и вида:
Сортировка линками: «По популярности», «По алфавиту», «По цене». Активный — оранжевый. По цене — переключение ↑/↓.
Тогглы вида: квадраты (сетка) и список.
Карточки товаров — как на главной, 4 в ряд.
Пример товаров (из скрина, использовать как мок‑данные):
«Пивоварня Beer Zavodik Start» — 3 390 ₽/шт — статус «Достаточно».
«Пивоварня Beer Zavodik Classic» — 3 790 ₽/шт — «Достаточно».
«Крышка для ЦКТ Easy Brew 32 л с чиллером» — 7 641 ₽/шт — «Достаточно».
«Домашняя пивоварня Бавария "BAVARIA 50L" WiFi» — 57 990 ₽/шт — «Мало».
Карточка товара (/product/[slug])
Хлебные крошки: «Главная — Каталог — Пивоварение — Пивоварни и ЦКТ — Пивоварня Beer Zavodik Start».
Основной блок:
Слева: большое изображение 520×520 (квадрат), в правом верхнем углу — иконка «в избранное».
Справа:
Название H1.
Рейтинг (5 звёзд), под ним цена крупно «3 390 ₽/шт».
Статус наличия с зелёной галочкой «Достаточно».
Линк мелким «Нашли дешевле?».
Контрол количества: [-] [число] [+] (высота 36, ширина поля 48).
Кнопки:
«В корзину» (оранжевая, 160×40, иконка корзины слева).
«Купить в 1 клик» (оранжевая outline, 160×40).
Группа «Поделиться» (иконки VK, YouTube, Telegram, Viber? и WhatsApp). По клику — копирование ссылки + уведомление.
Примечание мелким: «Цена действительна только для интернет‑магазина и может отличаться от цен в розничных магазинах».
Табы ниже (sticky в пределах карточки не нужен):
«Описание» (активный): текст‑рыба о наборе.
«Отзывы»: заглушка «Пока нет отзывов».
«Задать вопрос»: форма (имя, телефон/email, сообщение, чек согласия).
«Дополнительно»: таблица характеристик (плейсхолдер).
Кнопки добавления/избранного/сравнения — показывают тост «Товар добавлен…» и обновляют счётчики в правой панели.
Поиск
Страница /search?query=…: заголовок «Результаты поиска по “{запрос}”», количество найденных, сетка карточек как в категории, если пусто — «Ничего не найдено» + рекомендации.
Модалки
«Заказать звонок»: поля Имя, Телефон, время для связи (select), кнопка «Отправить». Валидировать маску телефона.
«Нашли дешевле?»: поля Ссылка на товар конкурента, Цена, Комментарий; чек согласия.
«Бысткая покупка» («Купить в 1 клик»): Имя, Телефон, товар (readonly), кнопка «Отправить».
Все модалки — по центру, ширина 520px, радиус 10px, анимация scale‑in 120мс.
Футер
Верхняя полоса: логотипы партнёров (серые), карусель или статично.
Нижняя основная:
Слева: иконки платёжных систем (VISA, МИР, Tinkoff) — монохромные плейсхолдеры.
3 колонки ссылок:
«КОМПАНИЯ»: О компании; Новости; Магазины.
«ПОМОЩЬ»: Помощь; Условия доставки и оплаты.
«ИНФОРМАЦИЯ»: Статьи; Вопрос‑ответ.
Справа: телефоны как в шапке, подпись «ЗАКАЗАТЬ ЗВОНОК» (линк, модалка), ниже — «Мы в социальных сетях:» и иконки VK, YouTube, Telegram, Viber/OK (фиолетовая), WhatsApp (зелёная).
Самый низ: строка мелким «Разработка сайтов на 1С‑Битрикс — KONTUR» (линк).
Поведение и интеракции (обязательно)
Хэдер липкий: при прокрутке прилипает только оранжевая горизонтальная навигация (меню), добавляется лёгкая тень.
Левый сайдбар «Каталог» виден на всех страницах десктопа; при клике по «Каталог» в шапке — сворачивается/разворачивается (анимация slide).
Мегаменю появляется при hover категории в сайдбаре; скрывается при mouseleave, задержка 120мс, collision‑handling не нужен.
Все ссылки в списках открывают соответствующие страницы (роутинг local).
Кнопки карточек:
«В корзину»: добавляет 1 шт., тост «Товар добавлен в корзину», правый сайдбар счётчик +1.
«В избранное»: тост «Добавлено в избранное».
«Сравнить»: если включено — тост и подсветка иконки сравнения.
Корзина (сайд‑дроуэр):
Список товаров (мини‑картинка 64×64, имя, цена, количество с +/-), удаление (крестик).
Итог: подытог, скидка (если есть), всего. Кнопки «Продолжить покупки» (закрыть) и «Оформить» (заглушка).
Сортировка/фильтры реально фильтруют/сортируют мок‑данные на клиенте.
Табы «Хиты/Новинки/По акции» переключают набор карточек.
Кнопка «Наверх» — плавная прокрутка.
Фокус‑стили контрастные: outline 2px цветом --color-accent-blue.
Мок‑данные (data/*.ts)
categories.ts — массив из объектов:
{
slug: 'pivovareniye',
title: 'Пивоварение',
sub: [
{ title: 'Пивоварни и ЦКТ', count: 9, subslug: 'pivovarni-i-ckt' },
{ title: 'Ингредиенты', count: 152, subslug: 'ingredienty' },
{ title: 'Брожение и розлив', count: 52, subslug: 'brozhenie-i-rozliv' },
{ title: 'Пивные наборы и медовуха', count: 40, subslug: 'nabori-i-medovuha' },
{ title: 'Сидр и медовуха', count: 6, subslug: 'sidr-i-medovuha' },
{ title: 'Дополнительное оборудование', count: 33, subslug: 'dop-oborudovanie' },
],
}
Аналогично для «Самогоноварение», «Виноделие», «Шланги, соединения», «Тара и ёмкости», «Бондарные изделия», «Казаны…», «Всё для изготовления колбас», «Сыроделие», «Измерительное оборудование», «Автоклавы и коптильни», «Хлеб и квас», «Травы и специи», «Литература».
products.ts — массив:
{
id: 'zavodik-start',
slug: 'pivovarnya-beer-zavodik-start',
title: 'Пивоварня Beer Zavodik Start',
price: 3390,
stock: 'enough', // 'enough' | 'many' | 'few' | 'none'
rating: 3.5,
badges: ['hit'],
category: 'pivovareniye',
subcategory: 'pivovarni-i-ckt',
images: ['placeholder-1.jpg'],
}
... добавить «Classic», «Крышка для ЦКТ Easy Brew 32 л с чиллером», «Домашняя пивоварня Бавария "BAVARIA 50L" WiFi» (price 57990, stock: 'few').
Для блока «Хиты продаж» — 8–12 товаров (включая хмель, солод — с ценами 109 ₽/шт и т. п.).
articles.ts, news.ts — списки по скринам.
advantages.ts — 4 преимущества.
slider.ts — 3–5 слайдов с текстами и кнопками.
Компоненты (минимальный перечень)
Атомы:
Button (variants: primary, outline, link; sizes: sm/md; disabled; loading)
Icon (SVG wrapper)
Badge (labels «Хиты продаж», «Новинка», «По акции»)
Price (сложение форматирования ₽)
RatingStars (частичная заливка)
StockLabel (галочка + текст + цветовые варианты)
Input, Checkbox, Select, Range
Молекулы:
SearchBar, PhoneBlock, SocialIcons
ProductCard
CategoryTile
FeatureItem (преимущество)
Breadcrumbs
SortBar (вид + сортировка)
FiltersPanel (цена + чекбоксы + кнопки)
Организмы:
Header, TopNav
LeftCatalog (с мегаменю)
RightDock (плавающий сайдбар)
HeroSlider
ProductGrid
TabsSwitcher
Footer
SideDrawer, Modal, Toast
Страницы:
HomePage, CatalogPage, CategoryPage, ProductPage, StaticPages (about, stores, delivery, contacts), SearchPage.
Стили и детали пикселей
Карточки товаров: рамка 1px #E6E6E6, радиус 6px, паддинги 14–18px, тень при hover — --shadow-elev.
Ссылки по тексту: цвет --color-link; hover — подчеркивание.
Бейдж «Хиты продаж»: фон --color-accent-blue, текст белый, радиус 3px, паддинг 4×8, позиция absolute top:12 left:12.
Крошки: разделитель «—» (длинное тире), текущая страница — muted.
Таб‑свитчер: активный — нижняя линия 3px primary, неактивные — muted при hover окрашиваются в primary.
Инпуты: высота 40–42px, рамка #E6E6E6, радиус 4px, фокус — outline 2px #2A84D2.
Кнопки primary: фон primary‑600; hover primary‑700; active — тень внутрь; disabled — #F0F0F0, текст #A0A0A0.
Тексты, как на скринах (использовать дословно)
Шапка: «Дом Пивовара», «Поиск по товарам», телефоны «+7 913 555-222-6», «+7 913 037-32-47», «ЗАКАЗАТЬ ЗВОНОК».
Меню: «КАТАЛОГ», «О КОМПАНИИ», «АКЦИИ», «МАГАЗИНЫ», «СТАТЬИ», «ДОСТАВКА И ОПЛАТА», «КОНТАКТЫ».
Слайдер: «Скидки», «Узнать больше о скидках».
Преимущества: «Подарочные сертификаты», «Весь товар сертифицирован», «30 дней на обмен и возврат», «Удобная и быстрая доставка».
Плитки: «Пивоварение», «Самогоноварение», «Виноделие», «Казаны, мангалы, печи, посуда», «Бондарные изделия», «Сыроделие».
Блок подписки: «Будьте всегда в курсе!», «Узнавайте о скидках и акциях первыми», «Ваш e-mail».
Новости/Статьи: как в описании выше.
Табы: «Хиты продаж», «Новинки», «По акции».
Листинг: «По популярности», «По алфавиту», «По цене».
Карточка товара: «Нашли дешевле?», «В корзину», «Купить в 1 клик», «Поделиться», «Цена действительна только для интернет‑магазина и может отличаться от цен в розничных магазинах».


Футер: «КОМПАНИЯ», «ПОМОЩЬ», «ИНФОРМАЦИЯ», «Мы в социальных сетях:», «Разработка сайтов на 1С‑Битрикс — KONTUR».

### Футер (нижняя часть сайта)

Футер состоит из трёх горизонтальных уровней:

1. **Полоса логотипов партнёров (уже описана выше в блоке «О Доме Пивовара», но зафиксировать):**
   - Фон — белый.
   - Находится сразу под блоком «О Доме Пивовара», отделена от него тонкой светло‑серой горизонтальной линией (1px, `--color-border`).
   - Высота по контенту (~80–100px). Внутри — контейнер шириной 1200px.
   - Логотипы партнёров (5–7 штук) выровнены по центру по горизонтали, идут в один ряд, между ними равные отступы ~40px.
   - Все логотипы монохромные, слегка полупрозрачные (opacity ~0.5–0.6). При hover — увеличивать opacity до 1, курсор `pointer`, но переходить никуда не нужно (можно оставить `href="#"` или заглушку).
   - Высота логотипа ~32–40px, ширина пропорциональна.

2. **Основной блок футера (серый фон):**
   - Фон: `--color-bg` (#F5F6F7).
   - Верхняя граница 1px `--color-border`.
   - Внутренний вертикальный паддинг: 32px сверху и снизу.
   - Внутри — тот же контейнер 1200px, по центру.
   - Макет: одна строка с четырьмя логическими зонами:
     1) блок платёжных систем слева,
     2) колонка «КОМПАНИЯ»,
     3) колонка «ПОМОЩЬ»,
     4) колонка «ИНФОРМАЦИЯ»,
     5) блок контактов и соцсетей справа.
   - На ≥1366px четыре колонки + контакты располагаются в один ряд с равномерными промежутками (`justify-content: space-between`). На 1024–1365 допускается небольшое сжатие, но порядок и соотношение ширин сохраняется. На <1024 — колонки становятся в два ряда: слева платёжные + «КОМПАНИЯ», справа «ПОМОЩЬ» + «ИНФОРМАЦИЯ» и под ними контакты, но структура элементов не меняется.

   #### 2.1. Платёжные системы
   - Располагаются в левом верхнем углу футера.
   - Текстовый заголовок не нужен — только иконки.
   - Иконки в один ряд: VISA, МИР, Tinkoff (обязательно), можно добавить до 2–3 дополнительных сервисов (QIWI, ЮMoney и т. п.) в виде условных монохромных логотипов.
   - Иконки прямоугольные, высота 24px, ширина 40–48px, внутри простая монохромная разметка (лого в линию, фон белый, закругление 4px, тонкая рамка #DDDDDD).
   - Между иконками горизонтальный отступ 8–12px.
   - При hover: лёгкая тень (как `--shadow-card`) и увеличение масштабом 1.03 (transition 120ms).

   #### 2.2. Колонки ссылок «КОМПАНИЯ», «ПОМОЩЬ», «ИНФОРМАЦИЯ»
   - Каждая колонка — вертикальный список.
   - Ширина одной колонки ~180–200px.
   - Заголовок колонки:
     - Текст: строго caps: «КОМПАНИЯ», «ПОМОЩЬ», «ИНФОРМАЦИЯ».
     - Шрифт: 14px, 700, `--color-text`.
     - Нижний отступ от заголовка до списка: 12px.
   - Список ссылок:
     - Межстрочный интервал 1.4, отступ между пунктами 6–8px.
     - Цвет текста ссылок: `--color-text` (#333).
     - При hover: цвет `--color-link`, подчёркивание.
     - Пункты:
       - «КОМПАНИЯ»: «О компании», «Новости», «Магазины».
       - «ПОМОЩЬ»: «Помощь», «Условия доставки и оплаты».
       - «ИНФОРМАЦИЯ»: «Статьи», «Вопрос‑ответ».
     - Каждая ссылка ведёт на соответствующий роут (`/about`, `/news`, `/stores`, `/help`, `/delivery`, `/articles`, `/faq`).

   #### 2.3. Блок контактов и соцсетей (справа)
   - Выравнивание по правому краю контейнера.
   - Структура сверху вниз:
     1) иконка телефона + телефоны,
     2) ссылка «ЗАКАЗАТЬ ЗВОНК ОК»,
     3) подпись «Мы в социальных сетях:»,
     4) ряд иконок соцсетей.
   - Иконка телефона:
     - Круг 32×32, фон `--color-primary-600`, иконка трубки белая 16×16.
     - Располагается слева от блока телефонов с горизонтальным отступом 8px.
   - Телефоны:
     - Две строки: «+7 913 555-222-6» и «+7 913 037-32-47».
     - Шрифт 16px, 600, цвет `--color-text`.
     - Межстрочный интервал 1.2–1.3.
   - Ссылка «ЗАКАЗАТЬ ЗВОНК ОК»:
     - Расположена под телефонами, выровнена по левому краю телефонного блока.
     - Шрифт 12–13px, caps, цвет `--color-primary-600`.
     - При hover: цвет `--color-primary-700`, подчёркивание.
     - По клику: открывается модалка «Заказать звонок» (описана выше). Модалка одна и та же, что в хедере.
   - Текст «Мы в социальных сетях:»:
     - Мелкий текст 14px, 400, `--color-muted`.
     - Отступ сверху от блока с телефонами ~16px.
   - Иконки соцсетей:
     - Расположены в один ряд, слева направо: VK, YouTube, Telegram, Viber/OK (фиолетовый квадрат), WhatsApp (зелёный квадрат).
     - Каждая иконка — квадрат 32×32, радиус 4px.
     - Фон — фирменный цвет (VK — синий, YouTube — красный, Telegram — голубой, Viber/OK — фиолетовый, WhatsApp — зелёный).
     - Внутри — белый знакомый пиктограммный значок.
     - При hover: яркость +10%, лёгкая тень `--shadow-card`, курсор pointer.
     - По клику: пока просто открывать `window.open('#', '_blank')` или показывать тост «Переход к соцсети (заглушка)».

3. **Нижняя тонкая полоса:**
   - Фон тот же, что в основном футере, но сверху есть дополнительная граница 1px `--color-border`.
   - Высота по контенту, вертикальный паддинг ~12px.
   - Внутри контейнера текст мелким шрифтом 13–14px, цвет `--color-muted`.
   - Текст слева: «Разработка сайтов на 1С‑Битрикс — KONTUR».
   - Слово «KONTUR» — ссылка (`href="#"`), цвет `--color-link`, при hover подчёркивание.
   - На мобильных (<768px) текст центрировать.

---

### Логика форматирования и статусов (уточнение и дополнение)

1. **Цены:**
   - Всегда выводятся с разделением тысяч неразрывным пробелом: `57 990 ₽/шт`.
   - Формат: `<сумма> <символ_рубля>/шт`.
   - Для числового значения используется форматер, например `new Intl.NumberFormat('ru-RU')`.
   - Везде, где цена зависит от количества (например, в корзине), итог считается как `price * quantity`, форматируется тем же образом.
   - Если нужно показать старую цену (для акций): отображать её серым цветом и зачёркнутой, слева от новой цены, чуть меньшим кеглем (14px).

2. **Статусы наличия:**
   - Везде используются типы: `'many' | 'enough' | 'few' | 'none'`.
   - Отображение:
     - `many`:
       - Текст «Много».
       - Цвет текста: `--color-success`.
       - Иконка: зелёная галочка (16×16) слева от текста.
     - `enough`:
       - Текст «Достаточно».
       - Цвет текста: `--color-success`.
       - Та же зелёная галочка.
     - `few`:
       - Текст «Мало».
       - Цвет текста: `--color-warning` (оранжевый).
       - Иконка: оранжевый знак (например, треугольничек или точка) без красного, без перечёркивания.
     - `none`:
       - Текст «Нет в наличии».
       - Цвет текста: `#9E9E9E` (серый).
       - Иконка: серый перечёркнутый круг или перечёркнутый чекбокс.
       - Все кнопки «В корзину» для этого товара должны быть в состоянии `disabled`:
         - фон `#F0F0F0`,
         - текст `#A0A0A0`,
         - курсор `not-allowed`,
         - без hover‑эффектов.
   - Компонент `StockLabel` принимает пропсы `{ stock: 'many' | 'enough' | 'few' | 'none' }` и сам выбирает цвет, иконку и текст.

3. **Рейтинг:**
   - Рейтинг хранится и передаётся как число с плавающей точкой (0–5) с шагом 0.5.
   - При рендеринге:
     - Округлять до ближайшего 0.5 (например, 3.3 → 3.5, 3.74 → 3.5).
     - Использовать 5 звёздочек одинакового размера (16×16).
     - Фон звезды: контур серый, заливка светло‑серая.
     - Количество полностью заполненных звёзд = `Math.floor(rating)`.
     - Если есть остаток 0.5 — следующая звезда заполняется наполовину (использовать SVG‑маску/клип).
     - Заполненная часть — цвет `--color-star`.
   - Для товаров без отзывов можно показывать пустые звезды и серый текст «Нет отзывов» справа.

---

### Тестовые сценарии (acceptance, расширенная версия)

Реализовать и проверить следующие сценарии (все должны работать в итоговом проекте):

1. **Мегаменю «Самогоноварение»:**
   - При наведении мышью на пункт «Самогоноварение» в левом вертикальном каталоге:
     - Элемент строки подсвечивается (фон `#FFF5EB`, правая стрелка становится оранжевой).
     - Справа, над основной контентной областью, появляется мегаменю шириной ~860px, как описано ранее (4 колонки с подкатегориями и картинками 24×24).
   - Мегаменю закрывается:
     - при уходе курсора с области мегаменю и пунктов сайдбара (использовать `mouseleave` с задержкой ~120мс),
     - при клике в любом месте вне сайдбара и мегаменю.
   - При клике по любой ссылке в мегаменю:
     - происходит переход на соответствующий роут `/catalog/[slug]/[subslug]` или временный `/catalog/samogonovarenie/...` с передачей `subslug` как параметра.

2. **Слайдер на главной:**
   - Автоматическая прокрутка слайдов каждые 5 секунд.
   - При наведении на область слайдера автопрокрутка ставится на паузу (до ухода курсора).
   - Нижние точки‑индикаторы:
     - отображают количество слайдов (3–5),
     - активная точка — полностью белая, остальные — белые с 50% прозрачностью.
     - по клику на точку — мгновенный переход к соответствующему слайду.
   - Стрелки «влево»/«вправо»:
     - скрыты по умолчанию (opacity 0), появляются при hover на область слайдера (opacity 1).
     - при клике меняют слайд, зацикливание (последний → первый, первый → последний).
   - Кнопка CTA «Узнать больше о скидках»:
     - по клику показывает тост/alert «Переход к акциям (заглушка)».
     - опционально может делать `router.push('/sales')`.

3. **Табы «Хиты продаж / Новинки / По акции»:**
   - При загрузке главной активен таб «Хиты продаж».
   - Карточки из мока для «Хиты продаж» отображаются первыми (8–12 штук).
   - Переключение табов:
     - активному табу добавляется оранжевая нижняя линия 3px,
     - загружается соответствующий массив товаров («новинки», «по акции»),
     - сетка и стили карточек остаются одинаковыми.
   - Для товара «Домашняя пивоварня Бавария "BAVARIA 50L" WiFi»:
     - цена на карточке и на странице товара — «57 990 ₽/шт»,
     - статус — «Мало» (оранжевый индикатор).

4. **Фильтр и сортировка в листинге:**
   - Страница `/catalog/pivovareniye/pivovarni-i-ckt`:
     - Слайдер цены и поля ввода синхронизированы:
       - изменение значений полей приводит к перемещению ползунков,
       - движение ползунков обновляет значения в полях и подписи над слайдером (например, «3 390 — 57 990»).
     - Чекбокс «По акции (1)»:
       - при включении фильтрует листинг так, чтобы остались только товары, помеченные как акция (в мок‑данных добавить минимум один такой товар).
       - количество в скобках рядом с названием чекбокса соответствует количеству акционных товаров в текущей выборке.
     - Кнопка «Показать» применяет текущие фильтры и сортировку.
     - Кнопка «Сбросить» возвращает фильтры/сортировку к состоянию по умолчанию.
   - Сортировка:
     - «По популярности» — дефолт, сортирует по полю `popularity` (если нет, можно захардкодить порядок).
     - «По алфавиту» — сортировка по `title` (русский алфавит, localeCompare('ru')).
     - «По цене»:
       - первый клик — сортировка по возрастанию; слева от текста или справа показывается стрелка ▲.
       - второй клик — сортировка по убыванию; стрелка меняется на ▼.
       - последующие клики переключают ▲/▼.
     - Активная сортировка — оранжевый цвет, остальные — серые ссылки.

5. **Карточки товаров и корзина:**
   - Любая кнопка «В корзину»:
     - увеличивает количество данного товара в глобальном состоянии корзины на 1 (если товара не было — добавляет).
     - показывает тост в правом нижнем углу: «Товар добавлен в корзину».
       - Тост исчезает автоматически через 3 секунды или при клике на крестик.
     - Счётчик на иконке корзины в правом плавающем сайдбаре увеличивается на 1 (общий суммарный count).
   - Кнопка «В избранное»:
     - добавляет/удаляет товар из избранного (переключатель).
     - показывает тост «Добавлено в избранное» или «Удалено из избранного».
     - счётчик на иконке сердца обновляется.
   - Кнопка «Сравнить» (на карточке товара или в детали товара, если реализована):
     - добавляет товар в список сравнения (максимум 4).
     - при попытке добавить 5‑й — показывать тост «Нельзя добавить более 4 товаров для сравнения».
     - иконка «Сравнение» в правом сайдбаре подсвечивается (фон чуть светлее иконки).
   - Сайд‑дроуэр корзины:
     - Открывается по клику на кнопку корзины в правом сайдбаре.
     - Ширина 420px, фон белый, тень `--shadow-elev`, позиция `fixed` справа, высота 100% окна.
     - Внутри:
       - заголовок «Корзина»,
       - список товаров:
         - мини‑картинка 64×64 слева,
         - название (до 2 строк с многоточием) и цена под ним,
         - справа — контрол количества [-] [число] [+] и иконка удаления (крестик).
       - блок итогов:
         - «Подытог», «Скидка» (если есть), «Итого».
       - кнопки:
         - «Продолжить покупки» — закрывает дроуэр.
         - «Оформить» — показывает тост «Оформление заказа (заглушка)».
     - Закрытие:
       - по клику на иконку «крестик» в шапке дроуэра,
       - по клику на затемнённый фон вне дроуэра,
       - по нажатию Esc.

6. **Страница товара:**
   - Контрол количества:
     - Кнопка «-»:
       - не даёт опуститься ниже 1 (при 1 — disabled).
     - Кнопка «+»:
       - увеличивает количество на 1.
     - Ввод вручную: разрешён только целочисленный ввод >0, при вводе некорректных символов — очищать или приводить к допустимому значению.
   - Кнопка «В корзину»:
     - добавляет товар в корзину с указанным количеством.
     - показывает тост «Товар добавлен в корзину».
   - Кнопка «Купить в 1 клик»:
     - открывает модалку «Быстрая покупка».
     - В модалке поле «Товар» заполнено названием и ценой, только чтение.
   - Ссылка «Нашли дешевле?»:
     - маленький текст справа от статуса наличия/цены.
     - По клику открывает модалку «Нашли дешевле?».
   - Группа «Поделиться»:
     - Небольшая подпись «Поделиться» и иконки соцсетей (как в футере, но меньшего размера, 24×24).
     - По клику на любую иконку:
       - копируется текущий URL товара в буфер обмена,
       - показывается тост «Ссылка на товар скопирована».
   - Табы:
     - При переключении табов контент под ними перерисовывается без смены URL.
     - Активный таб — оранжевая нижняя линия 3px, фон белый; неактивные — серый текст на белом фоне.
     - Навигация по табам доступна с клавиатуры (focus/Enter/Space).

7. **Поиск:**
   - Поиск в шапке:
     - Ввод строки и нажатие Enter или клик по иконке лупы:
       - переход на `/search?query=<encoded>`.
     - Если поле пустое — ничего не делать или показать простое сообщение «Введите запрос» (тост).
   - Страница /search:
     - Заголовок: «Результаты поиска по “{запрос}”».
     - Ниже текст мелким шрифтом: «Найдено: N товаров».
     - Если N > 0 — отображать сетку карточек товаров (та же, что в листинге).
     - Если N = 0 — отображать текст «Ничего не найдено» и блок с рекомендациями (например, «Попробуйте изменить запрос или зайдите в каталог» с ссылкой `/catalog`).

8. **Модальные окна:**
   - Общие требования:
     - Затемнённый фон (`rgba(0,0,0,0.4)`), модалка по центру экрана.
     - Ширина ~520px, радиус `--radius-lg` (10px).
     - Анимация появления: scale‑in от 0.95 до 1 и fade‑in 120мс.
     - Закрытие:
       - по клику по крестику,
       - по клику по фону,
       - по Esc.
   - «Заказать звонок»:
     - Поля:
       - Имя (обязательное, текст).
       - Телефон (обязательное, маска `+7 (___) ___-__-__`).
       - Время для связи (Select с опциями: «В ближайшее время», «С 9:00 до 13:00», «С 13:00 до 18:00»).
     - Кнопка «Отправить»:
       - disabled, пока форма не валидна.
       - По успешной валидации: вместо реального запроса показывать тост «Заявка на звонок отправлена (заглушка)» и закрывать модалку через 1.5–2 секунды.
   - «Нашли дешевле?»:
     - Поля:
       - Ссылка на товар конкурента (обязательное, URL‑валидация).
       - Цена (обязательное, только число >0).
       - Комментарий (textarea, необязательное).
       - Чек «Согласен на обработку персональных данных» (обязателен для активации кнопки).
     - Кнопка «Отправить» — аналогично предыдущей.
   - «Быстрая покупка» («Купить в 1 клик»):
     - Поля:
       - Имя (обязательное).
       - Телефон (обязательное, маска).
       - Товар (readonly, название + количество + цена).
     - Поведение кнопки «Отправить» — аналогично.

9. **Кнопка «Наверх»:**
   - Появляется плавно (fade‑in/slide‑up) при прокрутке страницы более чем на 600px от верха.
   - Расположение: фиксировано справа снизу, отступ от правого и нижнего края 24px (на мобильных 16px).
   - При клике:
     - плавная прокрутка к началу страницы (`window.scrollTo({top: 0, behavior: 'smooth'})`).
   - Доступность:
     - имеет `aria-label="Наверх"`,
     - фокусируемая с клавиатуры, по Enter/Space выполняет то же действие.

10. **Хедер и липкая навигация:**
    - При прокрутке вниз:
      - верхняя белая часть шапки (логотип, поиск, телефоны) остаётся на месте (скроллится),
      - только оранжевая горизонтальная полоса меню (`TopNav`) прилипает к верхнему краю (`position: sticky; top: 0`).
      - К ней добавляется тень `--shadow-card` для визуального отделения.
    - Левый сайдбар «Каталог»:
      - На десктопе ≥1024px всегда виден слева.
      - При клике на пункт «КАТАЛОГ» в оранжевом горизонтальном меню:
        - Сайдбар сворачивается/разворачивается с анимацией slide‑in/slide‑out (ширина 270px → 0, контент подстраивается).
      - На планшете и мобильных:
        - Сайдбар по умолчанию скрыт.
        - Клик по «КАТАЛОГ» открывает off‑canvas панель на всю высоту экрана, шириной 270px или 80% ширины экрана (что меньше), с затемнением фона.
      - Активная категория в сайдбаре подсвечивается:
        - оранжевая вертикальная полоса слева (2–3px),
        - фон чуть темнее (`#FFF5EB`).

11. **Статические страницы верхнего меню:**
    - Роуты `/about`, `/sales`, `/stores`, `/articles`, `/delivery`, `/contacts`, `/help`, `/faq`, `/news`.
    - Общий шаблон:
      - H1 с названием страницы (как на реальном сайте),
      - хлебные крошки над заголовком,
      - основной контент — текст‑рыба и/или список карточек (для «Новости», «Статьи»).
    - Страница «Магазины»:
      - Список магазинов в виде карточек или таблицы (город, адрес, телефон), данные можно захардкодить.
    - Страница «Контакты»:
      - Блок с реквизитами, телефоном, email, текстом «Как до нас добраться».
    - Страница «Новости» и «Статьи»:
      - Список карточек:
        - заголовок,
        - дата,
        - краткое описание/анонс,
        - ссылка «Подробнее» (может вести на `/articles/[slug]` или `/news/[slug]` c заглушкой).

12. **Состояния и фокус:**
    - Для всех кликабельных элементов (кнопки, ссылки, элементы меню, иконки соцсетей, элементы сайдбара):
      - состояние `hover` — по ТЗ (цвета, тени),
      - состояние `active` — лёгкое затемнение/вдавливание,
      - состояние `focus-visible` — outline 2px цветом `--color-accent-blue`, без изменения layout (использовать `outline-offset: 2px`).
    - Не использовать `outline: none` без замены на доступный фокус.

---

### Дополнительные требования к реализации (для Cursor)

1. **Состояние приложения:**
   - Использовать React Context или простой Zustand/Redux‑аналог для хранения:
     - корзины (`cartItems`),
     - избранного (`favorites`),
     - сравнения (`comparison`),
     - состояний сайд‑дроуэров/модалок/тостов.
   - Состояние может сохраняться в `localStorage` (опционально), чтобы корзина не пропадала при перезагрузке.

2. **Реализация модулей:**
   - Все описанные выше сущности (Header, Footer, LeftCatalog, RightDock, HeroSlider, ProductGrid, ProductCard, Modals, SideDrawer, Toast) должны быть вынесены в отдельные компоненты в `/components`.
   - Моки лежат в `/data` и импортируются там, где нужны.

3. **Маршрутизация и SEO:**
   - Все перечисленные роуты должны существовать и возвращать корректный JSX.
   - Для товарных страниц использовать динамический сегмент `/product/[slug]`.
   - Для категорий и подкатегорий — `/catalog/[slug]` и `/catalog/[slug]/[subslug]`.
   - Добавить `<head>` с `title`, `meta description`, а также Open Graph теги на ключевых страницах (home, category, product).

4. **Респонсивность:**
   - На основе скриншотов повторить расположение блоков:
     - На широком десктопе всё как на оригинале.
     - На компактном десктопе и планшете уменьшить отступы, количество карточек в ряд (4/3/2/1).
     - На мобильном сохранять логику, но допускается упрощение (левый сайдбар — off‑canvas, правый сайдбар — свернуть в нижний док или иконку в шапке).

5. **Завершённость:**
   - После генерации кода проект должен:
     - компилироваться без ошибок TypeScript,
     - запускаться через `npm run dev`/`pnpm dev`,
     - все отмеченные выше сценарии должны быть кликабельны и демонстрировать описанное поведение (пусть и с мок‑данными/заглушками вместо реальных запросов).

Используй все приведённые выше детали оформления, размеров, цветов и поведения, чтобы сгенерированный Cursor‑ом проект максимально точно (1‑в‑1) воспроизводил десктопную версию сайта «Дом Пивовара» по скриншотам и текстовому ТЗ, без доступа к исходным картинкам.



backend_prompt.md:
# Техническая спецификация интернет-магазина

## Содержание
1. [Общая архитектура](#общая-архитектура)
2. [Технологический стек](#технологический-стек)
3. [База данных](#база-данных)
4. [Система аутентификации](#система-аутентификации)
5. [API Endpoints](#api-endpoints)
6. [Админ-панель](#админ-панель)
7. [Функционал магазина](#функционал-магазина)
8. [Система импорта/экспорта](#система-импортаэкспорта)
9. [Email система](#email-система)
10. [Файловая система](#файловая-система)
11. [Развертывание](#развертывание)

---

## Общая архитектура

### Тип приложения
- **Full-stack Next.js приложение** (App Router)
- **Монолитная архитектура** с разделением на клиентскую и серверную части
- **RESTful API** для всех операций с данными
- **Server-Side Rendering (SSR)** и **Static Site Generation (SSG)**

### Структура проекта
```
/
├── src/
│   ├── app/              # Next.js App Router страницы и API routes
│   │   ├── api/          # API endpoints
│   │   ├── admin/        # Админ-панель (страницы)
│   │   └── [pages]/      # Публичные страницы
│   ├── components/       # React компоненты
│   ├── lib/              # Утилиты и сервисы
│   ├── store/            # Zustand stores (состояние)
│   └── types/            # TypeScript типы
├── prisma/               # Prisma ORM схема и миграции
├── public/               # Статические файлы
└── tests/                # Тесты (Jest + Playwright)
```

---

## Технологический стек

### Backend
- **Next.js 14** (App Router)
- **TypeScript 5.3**
- **Prisma ORM 5.7** (PostgreSQL)
- **Node.js 18+**

### Frontend
- **React 18.2**
- **Tailwind CSS 3.3**
- **Zustand 4.4** (state management)
- **React Hook Form 7.48** (формы)
- **Zod 3.22** (валидация)
- **Framer Motion 10.16** (анимации)

### База данных
- **PostgreSQL 15**
- **Prisma Client** для запросов

### Аутентификация
- **JWT (jsonwebtoken)** - access tokens (15 минут)
- **JWT Refresh Tokens** - refresh tokens (7 дней)
- **bcryptjs** - хеширование паролей
- **Sessions** - хранение refresh tokens в БД

### Дополнительные библиотеки
- **nodemailer** - отправка email
- **sharp** - обработка изображений
- **papaparse** - парсинг CSV
- **xlsx** - работа с Excel
- **jszip** - работа с ZIP архивами
- **axios** - HTTP клиент
- **react-query** - кеширование данных

---

## База данных

### Схема базы данных (Prisma)

#### Модель User (Пользователь)
```prisma
model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  company   String?
  role      UserRole  @default(CUSTOMER)
  isBlocked Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  addresses Address[]
  orders    Order[]
  reviews   Review[]
  sessions  Session[]
}
```

**Роли пользователей:**
- `CUSTOMER` - обычный клиент
- `ADMIN` - администратор (полный доступ)
- `MANAGER` - менеджер (управление заказами и товарами)
- `VIEWER` - просмотрщик (только чтение)

#### Модель Session (Сессии)
```prisma
model Session {
  id           String   @id @default(cuid())
  userId       String
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
```

#### Модель Address (Адреса)
```prisma
model Address {
  id      String  @id @default(cuid())
  userId  String
  name    String
  street  String
  city    String
  region  String
  zipCode String
  phone   String?
  isMain  Boolean @default(false)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders  Order[]
}
```

#### Модель Category (Категории)
```prisma
model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  image       String?
  parentId    String?
  isActive    Boolean    @default(true)
  sortOrder   Int        @default(0)
  seoTitle    String?
  seoDesc     String?
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]
}
```

**Особенности:**
- Иерархическая структура (родитель-потомок)
- SEO поля (seoTitle, seoDesc)
- Сортировка через sortOrder

#### Модель Product (Товары)
```prisma
model Product {
  id          String            @id @default(cuid())
  sku         String            @unique
  title       String
  slug        String            @unique
  description String?
  content     String?
  price       Decimal           @db.Decimal(10, 2)
  oldPrice    Decimal?          @db.Decimal(10, 2)
  currency    String            @default("RUB")
  stock       Int               @default(0)
  minOrder    Int               @default(1)
  weight      Decimal?          @db.Decimal(8, 3)
  dimensions  String?
  material    String?
  category    ProductCategory   @default(ECONOMY)
  tags        String[]
  images      String[]
  isActive    Boolean           @default(true)
  isFeatured  Boolean           @default(false)
  isInStock   Boolean           @default(true)
  visibility  ProductVisibility @default(VISIBLE)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  seoTitle    String?
  seoDesc     String?
  metaTitle   String?
  metaDesc    String?
  categoryId  String
  orderItems  OrderItem[]
  variants    ProductVariant[]
  categoryObj Category          @relation(fields: [categoryId], references: [id])
  reviews     Review[]
}
```

**Enum ProductCategory:**
- `ECONOMY` - эконом класс
- `MIDDLE` - средний класс
- `LUXURY` - премиум класс

**Enum ProductVisibility:**
- `VISIBLE` - видимый
- `HIDDEN` - скрытый
- `DRAFT` - черновик

#### Модель ProductVariant (Варианты товаров)
```prisma
model ProductVariant {
  id        String      @id @default(cuid())
  productId String
  size      String?
  color     String?
  material  String?
  price     Decimal     @db.Decimal(10, 2)
  stock     Int         @default(0)
  sku       String      @unique
  imageUrl  String?
  isActive  Boolean     @default(true)
  product   Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]
}
```

**Особенности:**
- Каждый вариант имеет свой SKU, цену, остаток
- Может иметь отдельное изображение (imageUrl)
- Связан с основным товаром через productId

#### Модель Order (Заказы)
```prisma
model Order {
  id           String       @id @default(cuid())
  orderNumber  String       @unique
  userId       String
  status       OrderStatus  @default(NEW)
  total        Decimal      @db.Decimal(10, 2)
  subtotal     Decimal      @db.Decimal(10, 2)
  delivery     Decimal      @default(0) @db.Decimal(8, 2)
  discount     Decimal      @default(0) @db.Decimal(8, 2)
  firstName    String
  lastName     String
  company      String?
  phone        String
  email        String
  notes        String?
  deliveryType DeliveryType @default(PICKUP)
  addressId    String?
  trackNumber  String?
  promoCode    String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  items        OrderItem[]
  logs         OrderLog[]
  address      Address?     @relation(fields: [addressId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
}
```

**Enum OrderStatus:**
- `NEW` - новый заказ
- `PROCESSING` - в обработке
- `SHIPPED` - отгружен
- `DELIVERED` - доставлен
- `CANCELLED` - отменён

**Enum DeliveryType:**
- `PICKUP` - самовывоз
- `COURIER` - курьер
- `TRANSPORT` - транспортная компания

#### Модель OrderItem (Элементы заказа)
```prisma
model OrderItem {
  id         String          @id @default(cuid())
  orderId    String
  productId  String
  variantId  String?
  quantity   Int
  price      Decimal         @db.Decimal(10, 2)
  total      Decimal         @db.Decimal(10, 2)
  selectedColor String?
  selectedSize  String?
  order      Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product         @relation(fields: [productId], references: [id])
  variant    ProductVariant? @relation(fields: [variantId], references: [id])
}
```

#### Модель OrderLog (Логи заказов)
```prisma
model OrderLog {
  id        String      @id @default(cuid())
  orderId   String
  status    OrderStatus
  comment   String?
  createdAt DateTime    @default(now())
  createdBy String?
  order     Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)
}
```

#### Модель Review (Отзывы)
```prisma
model Review {
  id        String   @id @default(cuid())
  productId String
  userId    String
  rating    Int      @db.SmallInt
  title     String?
  content   String
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([productId, userId])
}
```

**Особенности:**
- Один пользователь может оставить только один отзыв на товар
- Отзывы требуют модерации (isActive = false по умолчанию)

#### Модель Lead (Заявки/Лиды)
```prisma
model Lead {
  id        String     @id @default(cuid())
  name      String
  phone     String?
  email     String?
  company   String?
  message   String?
  source    String?
  status    LeadStatus @default(NEW)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}
```

**Enum LeadStatus:**
- `NEW` - новая заявка
- `CONTACTED` - связались
- `QUALIFIED` - квалифицирована
- `CONVERTED` - конвертирована
- `LOST` - потеряна

#### Модель Setting (Настройки)
```prisma
model Setting {
  id    String      @id @default(cuid())
  key   String      @unique
  value String
  type  SettingType @default(STRING)
}
```

**Enum SettingType:**
- `STRING` - строка
- `NUMBER` - число
- `BOOLEAN` - булево
- `JSON` - JSON объект

**Основные настройки:**
- `contactEmail` - email для связи
- `contactPhone` - телефон
- `address` - адрес
- `minOrderTotal` - минимальная сумма заказа
- `socialLinks` - социальные сети (JSON)
- `extraContacts` - дополнительные контакты (JSON)
- `emailSettings` - настройки SMTP (JSON)
- `popupEnabled` - включен ли popup
- `popupTemplate` - шаблон popup
- `popupTitle`, `popupText`, `popupImageUrl` - контент popup
- `popupButtonLabel`, `popupButtonUrl` - кнопка popup
- `popupDelaySeconds` - задержка показа popup

#### Модель HeroImage (Главные изображения)
```prisma
model HeroImage {
  id        String   @id @default(cuid())
  url       String
  alt       String?
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

#### Модель Page (Страницы)
```prisma
model Page {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  content   String
  seoTitle  String?
  seoDesc   String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

#### Модель AuditLog (Логи аудита)
```prisma
model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  resource   String
  resourceId String?
  oldData    Json?
  newData    Json?
  ip         String?
  userAgent  String?
  createdAt  DateTime @default(now())
}
```

---

## Система аутентификации

### Механизм работы

1. **Регистрация/Вход:**
   - Пользователь отправляет email и password
   - Пароль хешируется через bcryptjs (12 rounds)
   - Создается JWT access token (15 минут) и refresh token (7 дней)
   - Refresh token сохраняется в таблице Session

2. **Access Token:**
   - Содержит: `userId`, `email`, `role`
   - Время жизни: 15 минут
   - Хранится в cookies или Authorization header

3. **Refresh Token:**
   - Содержит: `userId`
   - Время жизни: 7 дней
   - Хранится в cookies и БД (таблица Session)

4. **Обновление токена:**
   - При истечении access token, клиент отправляет refresh token
   - Сервер проверяет refresh token в БД
   - Выдает новую пару токенов

5. **Выход:**
   - Удаляется refresh token из БД
   - Очищаются cookies

### API Endpoints аутентификации

#### POST `/api/auth/register`
Регистрация нового пользователя

**Request:**
```json
{
  "firstName": "Иван",
  "lastName": "Иванов",
  "email": "ivan@example.com",
  "password": "password123",
  "phone": "+7 999 123-45-67",
  "company": "ООО Компания"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "...",
      "email": "ivan@example.com",
      "firstName": "Иван",
      "lastName": "Иванов",
      "role": "CUSTOMER"
    },
    "accessToken": "...",
    "refreshToken": "..."
  }
}
```

#### POST `/api/auth/login`
Вход в систему

**Request:**
```json
{
  "email": "ivan@example.com",
  "password": "password123"
}
```

**Response:** (аналогично register)

#### POST `/api/auth/refresh`
Обновление access token

**Request:**
```json
{
  "refreshToken": "..."
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "accessToken": "...",
    "refreshToken": "..."
  }
}
```

#### POST `/api/auth/logout`
Выход из системы

**Request:**
```json
{
  "refreshToken": "..."
}
```

#### GET `/api/auth/me`
Получение текущего пользователя

**Headers:**
```
Authorization: Bearer <accessToken>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "...",
    "email": "ivan@example.com",
    "firstName": "Иван",
    "lastName": "Иванов",
    "role": "CUSTOMER"
  }
}
```

### Middleware проверки прав

**Функция `verifyAuth(request)`** - проверяет наличие валидного access token
**Функция `verifyRole(request, ['ADMIN', 'MANAGER'])`** - проверяет роль пользователя

---

## API Endpoints

### Публичные API (без аутентификации)

#### GET `/api/products`
Получение списка товаров с фильтрацией

**Query параметры:**
- `page` - номер страницы (default: 1)
- `limit` - количество на странице (default: 20)
- `category` - slug категории
- `priceMin` - минимальная цена
- `priceMax` - максимальная цена
- `inStock` - только в наличии (true/false)
- `productCategory` - ECONOMY/MIDDLE/LUXURY
- `material` - фильтр по материалу
- `search` - поиск по названию/описанию
- `sortBy` - price/name/createdAt/rating
- `sortOrder` - asc/desc
- `id[]` - массив ID товаров (для избранного)

**Response:**
```json
{
  "success": true,
  "data": [...products],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "pages": 5
  }
}
```

#### GET `/api/products/[slug]`
Получение товара по slug

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "...",
    "title": "...",
    "price": 1000,
    "variants": [...],
    "categoryObj": {...},
    "reviews": [...]
  }
}
```

#### GET `/api/products/[slug]/variants`
Получение вариантов товара

#### GET `/api/categories`
Получение категорий

**Query параметры:**
- `includeProducts` - включить товары (true/false)
- `parentId` - фильтр по родительской категории

#### GET `/api/public-settings`
Получение публичных настроек сайта

#### GET `/api/hero-images`
Получение главных изображений для слайдера

### API для авторизованных пользователей

#### POST `/api/orders`
Создание заказа

**Headers:**
```
Authorization: Bearer <accessToken>
```

**Request:**
```json
{
  "items": [
    {
      "productId": "...",
      "variantId": "...",
      "quantity": 2,
      "selectedColor": "Красный",
      "selectedSize": "L"
    }
  ],
  "firstName": "Иван",
  "lastName": "Иванов",
  "phone": "+7 999 123-45-67",
  "email": "ivan@example.com",
  "deliveryType": "COURIER",
  "addressId": "...",
  "notes": "Комментарий"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "order": {...},
    "orderNumber": "TK-123456-ABC"
  }
}
```

#### GET `/api/orders`
Получение списка заказов пользователя

**Query параметры:**
- `page`, `limit` - пагинация
- `status` - фильтр по статусу
- `dateFrom`, `dateTo` - фильтр по дате
- `search` - поиск

#### GET `/api/orders/[id]`
Получение заказа по ID

#### GET `/api/users/[id]`
Получение профиля пользователя

#### GET `/api/users/[id]/addresses`
Получение адресов пользователя

#### POST `/api/users/[id]/addresses`
Создание адреса

#### PUT `/api/users/[id]/addresses/[addressId]`
Обновление адреса

#### DELETE `/api/users/[id]/addresses/[addressId]`
Удаление адреса

#### POST `/api/leads`
Создание заявки (лида)

**Request:**
```json
{
  "name": "Иван",
  "phone": "+7 999 123-45-67",
  "email": "ivan@example.com",
  "company": "ООО Компания",
  "message": "Текст сообщения",
  "source": "contact-form"
}
```

#### POST `/api/upload`
Загрузка файла (изображения)

**Request:** FormData
- `file` - файл изображения

**Response:**
```json
{
  "success": true,
  "data": {
    "url": "/uploads/filename.jpg",
    "filename": "filename.jpg"
  }
}
```

### Админ API (требует роль ADMIN/MANAGER)

#### GET `/api/admin/products`
Получение списка товаров (с расширенными фильтрами)

**Query параметры:**
- Все параметры из публичного API
- `visibility` - VISIBLE/HIDDEN/DRAFT
- `isActive` - true/false

#### POST `/api/admin/products`
Создание товара

**Request:**
```json
{
  "sku": "PROD001",
  "title": "Название товара",
  "slug": "nazvanie-tovara",
  "description": "Описание",
  "price": 1000,
  "oldPrice": 1200,
  "stock": 10,
  "minOrder": 1,
  "categoryId": "...",
  "category": "ECONOMY",
  "images": ["/uploads/image1.jpg"],
  "isActive": true,
  "isFeatured": false,
  "visibility": "VISIBLE",
  "variants": [
    {
      "sku": "VAR001",
      "color": "Красный",
      "size": "L",
      "price": 1000,
      "stock": 5,
      "imageUrl": "/uploads/variant1.jpg"
    }
  ]
}
```

#### PUT `/api/admin/products/[slug]`
Обновление товара

#### DELETE `/api/admin/products/[slug]`
Удаление товара

#### GET `/api/admin/products/[slug]/variants`
Получение вариантов товара

#### POST `/api/admin/products/[slug]/variants`
Создание варианта товара

#### PUT `/api/admin/products/[slug]/variants/[variantId]`
Обновление варианта

#### DELETE `/api/admin/products/[slug]/variants/[variantId]`
Удаление варианта

#### GET `/api/admin/orders`
Получение всех заказов (с фильтрами)

#### GET `/api/admin/orders/[id]`
Получение заказа

#### PUT `/api/admin/orders/[id]`
Обновление заказа (статус, трек-номер)

**Request:**
```json
{
  "status": "PROCESSING",
  "trackNumber": "TRACK123",
  "notes": "Комментарий"
}
```

#### GET `/api/admin/customers` (или `/api/users`)
Получение списка пользователей

**Query параметры:**
- `page`, `limit`
- `search` - поиск по имени/email/компании
- `role` - фильтр по роли
- `isBlocked` - true/false

#### GET `/api/admin/customers/[id]`
Получение пользователя

#### PUT `/api/admin/customers/[id]`
Обновление пользователя (роль, блокировка)

#### GET `/api/admin/categories`
Получение категорий

#### POST `/api/admin/categories`
Создание категории

#### PUT `/api/admin/categories/[id]`
Обновление категории

#### DELETE `/api/admin/categories/[id]`
Удаление категории

#### GET `/api/admin/leads`
Получение заявок

**Query параметры:**
- `page`, `limit`
- `status` - фильтр по статусу
- `search` - поиск

#### PUT `/api/admin/leads/[id]`
Обновление заявки (статус)

#### GET `/api/admin/analytics`
Получение аналитики

**Query параметры:**
- `period` - 7d/30d/90d/1y
- `startDate`, `endDate` - кастомный период

**Response:**
```json
{
  "success": true,
  "data": {
    "totalUsers": 100,
    "totalOrders": 50,
    "totalRevenue": 500000,
    "totalProducts": 200,
    "newUsers": 10,
    "newOrders": 5,
    "recentOrders": [...],
    "topProducts": [...],
    "orderStats": {
      "byStatus": {...},
      "byDate": [...]
    },
    "userStats": {
      "byDate": [...]
    },
    "revenueStats": {
      "byDate": [...]
    }
  }
}
```

#### GET `/api/admin/settings`
Получение всех настроек

#### PUT `/api/admin/settings`
Обновление настроек

**Request:**
```json
{
  "contactEmail": "info@example.com",
  "contactPhone": "+7 999 123-45-67",
  "address": "Адрес",
  "minOrderTotal": 1000,
  "socialLinks": [
    {"label": "VK", "url": "https://vk.com/..."}
  ],
  "extraContacts": [
    {
      "title": "Отдел продаж",
      "values": ["+7 999 111-11-11"]
    }
  ],
  "emailSettings": {
    "smtpHost": "smtp.gmail.com",
    "smtpPort": 587,
    "smtpUser": "user@gmail.com",
    "smtpPassword": "password",
    "fromEmail": "noreply@example.com",
    "companyEmail": "info@example.com"
  },
  "popupEnabled": true,
  "popupTemplate": "center",
  "popupTitle": "Заголовок",
  "popupText": "Текст",
  "popupImageUrl": "/uploads/popup.jpg",
  "popupButtonLabel": "Кнопка",
  "popupButtonUrl": "/catalog",
  "popupDelaySeconds": 3
}
```

#### GET `/api/admin/settings/[key]`
Получение конкретной настройки

#### PUT `/api/admin/settings/[key]`
Обновление конкретной настройки

#### GET `/api/admin/hero-images`
Получение главных изображений

#### POST `/api/admin/hero-images`
Создание главного изображения

**Request:**
```json
{
  "url": "/uploads/hero1.jpg",
  "alt": "Описание",
  "order": 0,
  "isActive": true
}
```

#### PUT `/api/admin/hero-images/[id]`
Обновление главного изображения

#### DELETE `/api/admin/hero-images/[id]`
Удаление главного изображения

#### GET `/api/admin/export`
Экспорт данных

**Query параметры:**
- `format` - zip/json/xlsx (default: zip)

**Response:** файл для скачивания

#### POST `/api/admin/import`
Импорт данных

**Request:** FormData
- `file` - ZIP архив с данными
- `options` - JSON с опциями:
  ```json
  {
    "skipExisting": false,
    "updateExisting": true,
    "importMedia": true
  }
  ```

**Response:**
```json
{
  "success": true,
  "data": {
    "processed": {
      "products": 100,
      "categories": 10,
      "media": 50
    },
    "errors": [],
    "warnings": [],
    "skipped": {
      "products": [],
      "categories": [],
      "media": []
    }
  }
}
```

#### POST `/api/admin/validate-file`
Валидация файла перед импортом

#### POST `/api/admin/import/wordpress-variants`
Импорт вариантов из WordPress

#### POST `/api/admin/test-email`
Тестирование email конфигурации

**Request:**
```json
{
  "to": "test@example.com"
}
```

---

## Админ-панель

### Структура админ-панели

Все страницы админ-панели находятся в `/admin/*` и защищены проверкой роли.

### Страницы админ-панели

#### `/admin` (Dashboard)
Главная страница с аналитикой:
- Общая статистика (пользователи, заказы, товары, выручка)
- Графики по периодам
- Последние заказы
- Топ товары

#### `/admin/products`
Управление товарами:
- Список товаров с фильтрами и поиском
- Создание/редактирование товара
- Управление вариантами товаров
- Массовые операции

**Функционал:**
- Фильтрация по категории, видимости, активности
- Поиск по названию, описанию, SKU
- Сортировка по цене, названию, дате создания, остатку
- Пагинация

#### `/admin/products/create`
Создание нового товара:
- Основная информация (название, описание, цена, остаток)
- Категория
- Изображения (множественная загрузка)
- SEO настройки
- Варианты товара (цвет, размер, материал)

#### `/admin/products/[slug]/edit`
Редактирование товара (аналогично созданию)

#### `/admin/orders`
Управление заказами:
- Список заказов с фильтрами
- Детали заказа
- Изменение статуса
- Добавление трек-номера
- История изменений

**Фильтры:**
- По статусу
- По дате
- По пользователю
- Поиск по номеру заказа, имени, email

#### `/admin/orders/[id]`
Детальная страница заказа:
- Информация о клиенте
- Состав заказа
- Адрес доставки
- История изменений статуса
- Возможность изменить статус и добавить трек-номер

#### `/admin/customers`
Управление клиентами:
- Список пользователей
- Фильтры по роли, блокировке
- Поиск по имени, email, компании
- Просмотр профиля клиента
- Изменение роли и блокировка

#### `/admin/customers/[id]`
Профиль клиента:
- Личная информация
- История заказов
- Адреса доставки

#### `/admin/categories`
Управление категориями:
- Древовидная структура категорий
- Создание/редактирование/удаление
- Настройка порядка сортировки
- SEO настройки

#### `/admin/leads`
Управление заявками:
- Список заявок
- Фильтры по статусу
- Изменение статуса заявки
- Просмотр деталей

#### `/admin/analytics`
Аналитика:
- Графики по выручке, заказам, пользователям
- Выбор периода (7 дней, 30 дней, 90 дней, год, кастомный)
- Топ товары
- Статистика по статусам заказов

#### `/admin/import-export`
Импорт/экспорт данных:
- Экспорт в ZIP/JSON/XLSX
- Импорт из ZIP архива
- Валидация файлов перед импортом
- Настройки импорта (пропускать существующие, обновлять, импортировать медиа)

#### `/admin/settings`
Настройки сайта:
- Контактная информация
- Социальные сети
- Дополнительные контакты
- Настройки email (SMTP)
- Настройки popup
- Минимальная сумма заказа

### Компоненты админ-панели

#### `AdminLayout`
Основной layout с:
- Боковым меню (sidebar)
- Верхней панелью с информацией о пользователе
- Навигацией между разделами
- Выходом из системы

#### `ProductVariantsManager`
Компонент для управления вариантами товара:
- Добавление/удаление вариантов
- Настройка цвета, размера, материала
- Установка цены и остатка для варианта
- Загрузка изображения для варианта

---

## Функционал магазина

### Корзина (Cart)

**Хранение:** Zustand store с persist (localStorage)

**Структура CartItem:**
```typescript
{
  id: string;
  productId: string;
  variantId?: string;
  quantity: number;
  price: number;
  product: Product;
  selectedColor?: string;
  selectedSize?: string;
}
```

**Методы:**
- `addItem(product, quantity)` - добавление товара
- `removeItem(itemId)` - удаление товара
- `updateQuantity(itemId, quantity)` - изменение количества
- `clearCart()` - очистка корзины
- `getTotalPrice()` - общая стоимость
- `getTotalItems()` - общее количество товаров

**Особенности:**
- Товары с разными вариантами считаются разными позициями
- Сохранение в localStorage для восстановления после перезагрузки

### Избранное (Favorites)

**Хранение:** Zustand store с persist (localStorage)

**Методы:**
- `add(productId)` - добавить в избранное
- `remove(productId)` - удалить из избранного
- `toggle(productId)` - переключить
- `has(productId)` - проверить наличие
- `getAll()` - получить все ID

### Профиль пользователя

**Страницы:**
- `/profile` - основной профиль
- `/profile/orders` - история заказов
- `/profile/addresses` - адресная книга
- `/profile/settings` - настройки аккаунта

**Функционал:**
- Просмотр и редактирование личной информации
- Управление адресами доставки
- История заказов с деталями
- Смена пароля

### Каталог товаров

**Страница:** `/catalog`

**Функционал:**
- Фильтрация по категориям
- Фильтрация по цене
- Фильтрация по наличию
- Фильтрация по категории товара (ECONOMY/MIDDLE/LUXURY)
- Поиск по названию/описанию
- Сортировка (цена, название, дата, рейтинг)
- Пагинация

### Страница товара

**Страница:** `/products/[slug]`

**Функционал:**
- Детальная информация о товаре
- Галерея изображений
- Выбор вариантов (цвет, размер, материал)
- Добавление в корзину
- Добавление в избранное
- Отзывы и рейтинг
- Похожие товары

### Оформление заказа

**Страница:** `/checkout`

**Шаги:**
1. Проверка корзины
2. Ввод данных доставки
3. Выбор способа доставки
4. Выбор адреса (или ввод нового)
5. Комментарий к заказу
6. Подтверждение и создание заказа

**После создания заказа:**
- Отправка email клиенту
- Отправка email администратору
- Очистка корзины
- Редирект на страницу заказа

### Публичные страницы

- `/` - главная страница
- `/about` - о компании
- `/contacts` - контакты
- `/delivery` - доставка
- `/return` - возврат
- `/privacy` - политика конфиденциальности
- `/faq` - часто задаваемые вопросы
- `/reviews` - отзывы
- `/services/custom` - индивидуальный пошив
- `/services/samples` - образцы
- `/services/wholesale` - опт

---

## Система импорта/экспорта

### Экспорт данных

**Формат:** ZIP архив, содержащий:
- `data.json` - все данные в JSON формате
- `media/` - папка с изображениями
- `README.md` - описание архива

**Структура data.json:**
```json
{
  "schemaVersion": "1.0",
  "exportedAt": "2024-01-01T00:00:00.000Z",
  "products": [...],
  "categories": [...],
  "mediaIndex": [...],
  "settings": {...}
}
```

**Форматы экспорта:**
- ZIP (по умолчанию) - полный экспорт с медиа
- JSON - только данные без медиа
- XLSX - Excel файл с листами (Товары, Категории, Настройки)

### Импорт данных

**Поддерживаемые форматы:**
- ZIP архив (с data.json и media/)
- JSON файл

**Процесс импорта:**
1. Валидация файла
2. Распаковка архива (если ZIP)
3. Парсинг data.json
4. Импорт категорий
5. Импорт товаров
6. Импорт вариантов товаров
7. Импорт медиафайлов (если включено)

**Опции импорта:**
- `skipExisting` - пропускать существующие записи
- `updateExisting` - обновлять существующие записи
- `importMedia` - импортировать изображения

**Результат импорта:**
```json
{
  "success": true,
  "processed": {
    "products": 100,
    "categories": 10,
    "media": 50
  },
  "errors": [],
  "warnings": [],
  "skipped": {
    "products": [],
    "categories": [],
    "media": []
  }
}
```

### Импорт из WordPress

**Endpoint:** `/api/admin/import/wordpress-variants`

Специальный импорт вариантов товаров из WordPress WooCommerce.

---

## Email система

### Конфигурация SMTP

Настройки хранятся в таблице Settings с ключом `emailSettings` (тип JSON):

```json
{
  "smtpHost": "smtp.gmail.com",
  "smtpPort": 587,
  "smtpUser": "user@gmail.com",
  "smtpPassword": "app-password",
  "fromEmail": "noreply@example.com",
  "companyEmail": "info@example.com"
}
```

### Отправка email

**Библиотека:** nodemailer

**Поддержка:**
- Gmail SMTP
- Yandex SMTP
- Mail.ru SMTP
- Outlook SMTP
- Кастомные SMTP серверы

**Fallback механизм:**
При ошибке подключения к основному SMTP, система пробует альтернативные конфигурации.

### Типы email

#### Email клиенту при создании заказа
- Тема: "Ваш заказ № [номер]"
- Содержит: состав заказа, общая сумма

#### Email администратору при новом заказе
- Тема: "Новый заказ № [номер]"
- Содержит: данные клиента, адрес доставки, состав заказа

### Тестирование email

**Endpoint:** `/api/admin/test-email`

Отправляет тестовое письмо для проверки конфигурации SMTP.

---

## Файловая система

### Загрузка файлов

**Endpoint:** `/api/upload`

**Ограничения:**
- Максимальный размер: 5MB (настраивается через MAX_FILE_SIZE)
- Разрешенные типы: image/jpeg, image/png, image/webp
- Сохранение в: `public/uploads/`

**Процесс:**
1. Валидация файла (размер, тип)
2. Генерация уникального имени файла
3. Сохранение в `public/uploads/`
4. Возврат URL файла

**Response:**
```json
{
  "success": true,
  "data": {
    "url": "/uploads/1234567890_filename.jpg",
    "filename": "1234567890_filename.jpg"
  }
}
```

### Обработка изображений

**Библиотека:** sharp

Возможности:
- Ресайз изображений
- Оптимизация качества
- Конвертация форматов

---

## Развертывание

### Переменные окружения

**Файл:** `.env`

```env
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/dbname"
DIRECT_URL="postgresql://user:password@localhost:5432/dbname"

# JWT
JWT_SECRET="your-jwt-secret-min-32-characters"
JWT_REFRESH_SECRET="your-jwt-refresh-secret-min-32-characters"

# Email
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
FROM_EMAIL="noreply@example.com"

# File Upload
UPLOAD_DIR="./public/uploads"
MAX_FILE_SIZE=5242880

# Site
SITE_URL="http://localhost:3000"
SITE_NAME="Название магазина"
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="admin123"
```

### Docker

**Файлы:**
- `Dockerfile` - образ приложения
- `docker-compose.yml` - оркестрация сервисов

**Сервисы:**
- `app` - Next.js приложение
- `db` - PostgreSQL база данных
- `nginx` - reverse proxy (опционально)

### Миграции базы данных

```bash
# Создание миграции
npm run db:migrate

# Применение миграций
npx prisma migrate deploy

# Генерация Prisma Client
npm run db:generate
```

### Сборка и запуск

```bash
# Установка зависимостей
npm install

# Генерация Prisma Client
npm run db:generate

# Применение миграций
npm run db:migrate

# Заполнение начальными данными (опционально)
npm run db:seed

# Разработка
npm run dev

# Сборка
npm run build

# Продакшн
npm start
```

### PM2 (для продакшна)

**Файл:** `ecosystem.config.js`

```bash
# Запуск
pm2 start ecosystem.config.js

# Остановка
pm2 stop ecosystem.config.js

# Перезапуск
pm2 restart ecosystem.config.js
```

---

## Дополнительные функции

### SEO

- Meta теги для каждой страницы
- Structured Data (JSON-LD)
- Sitemap.xml (автоматическая генерация)
- Robots.txt

### Аналитика

- Google Analytics (настраивается через переменные окружения)
- Facebook Pixel (настраивается через переменные окружения)
- События конверсий (покупка, добавление в корзину)

### Безопасность

- Хеширование паролей (bcrypt, 12 rounds)
- JWT токены с коротким временем жизни
- Refresh tokens в БД
- Валидация всех входных данных (Zod)
- Защита от SQL инъекций (Prisma)
- CORS настройки
- Rate limiting (через nodemailer для email)

### Производительность

- Server-Side Rendering (SSR)
- Static Site Generation (SSG) где возможно
- Кеширование через React Query
- Оптимизация изображений (sharp)
- Lazy loading компонентов

---

## Важные замечания для реализации

1. **Все API endpoints должны возвращать единый формат ответа:**
   ```json
   {
     "success": boolean,
     "data": any,
     "error": string (optional),
     "message": string (optional)
   }
   ```

2. **Пагинация всегда должна быть в формате:**
   ```json
   {
     "pagination": {
       "page": number,
       "limit": number,
       "total": number,
       "pages": number
     }
   }
   ```

3. **Все входные данные должны валидироваться через Zod схемы**

4. **Все защищенные endpoints должны проверять роль через `verifyRole()`**

5. **Пароли всегда хешируются через bcryptjs с 12 rounds**

6. **Все даты хранятся в UTC и отображаются в локальном времени**

7. **Изображения сохраняются в `public/uploads/` с уникальными именами**

8. **Email настройки хранятся в таблице Settings, а не в .env (для возможности изменения через админку)**

9. **Refresh tokens автоматически очищаются при истечении**

10. **Все операции с БД должны использовать Prisma Client, не сырые SQL запросы**

---

## Заключение

Данная спецификация описывает полную техническую реализацию интернет-магазина. Все описанные функции должны быть реализованы точно так же, как указано в документе. Дизайн и фронтенд могут отличаться, но вся бизнес-логика, API, база данных и админ-панель должны быть идентичными.

