# –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ VPS

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ `app/api/admin/promotions/route.ts`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω CSS Modules —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ `app/admin/promotions/page.module.scss` (button ‚Üí .button)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –æ–ø—Ü–∏—è `experimental.serverActions` –∏–∑ `next.config.js`

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å:

### 1. –§–∞–π–ª `.env` –Ω–µ –±—É–¥–µ—Ç —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª `.env` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.gitignore` –∏ –Ω–µ –±—É–¥–µ—Ç —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ VPS.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ VPS –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  - `DATABASE_URL` –∏ `DIRECT_URL` (–¥–ª—è Neon PostgreSQL –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î)
  - `JWT_SECRET` –∏ `JWT_REFRESH_SECRET` (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
  - `SMTP_*` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã)
  - `SITE_URL` (URL –≤–∞—à–µ–≥–æ VPS, –Ω–∞–ø—Ä–∏–º–µ—Ä: `https://yourdomain.com`)
  - `NODE_ENV="production"`
  - –ò –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `env.example`

### 2. –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π localhost –≤ `next.config.js`
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `next.config.js` –µ—Å—Ç—å `domains: ['localhost', ...]` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ VPS –≤ –º–∞—Å—Å–∏–≤ `domains` –≤ `next.config.js`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `remotePatterns` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤

### 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** `node_modules` –≤ `.gitignore`, –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install
```

### 4. Prisma Client –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
**–ü—Ä–æ–±–ª–µ–º–∞:** Prisma Client –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx prisma generate
```

### 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx prisma migrate deploy
```
‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `migrate deploy` –¥–ª—è production, –∞ –Ω–µ `migrate dev`!

### 6. –ü–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞–ø–∫–∞ `public/uploads` –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
mkdir -p public/uploads
```

## ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. ‚úÖ –ï—Å—Ç—å `env.example` —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. ‚úÖ Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π PostgreSQL (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)
3. ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≤ `package.json` –≥–æ—Ç–æ–≤—ã –¥–ª—è production (`build`, `start`)
4. ‚úÖ Prisma schema –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ PostgreSQL
5. ‚úÖ Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–∞—è –∏ —Ä–∞–±–æ—á–∞—è

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è VPS:

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
git clone <your-repo-url>
cd dom-pivovara
npm install
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ `.env` —Ñ–∞–π–ª–∞
```bash
cp env.example .env
nano .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ:**
- `DATABASE_URL` –∏ `DIRECT_URL` - –≤–∞—à–∏ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
- `SITE_URL` - URL –≤–∞—à–µ–≥–æ VPS (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://yourdomain.com`)
- `JWT_SECRET` –∏ `JWT_REFRESH_SECRET` - —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–ª—é—á–∏
- `NODE_ENV="production"`
- `SMTP_*` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Neon PostgreSQL (–æ–±–ª–∞–∫–æ)**
- –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `env.example`
- –ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `DATABASE_URL` –∏ `DIRECT_URL` –≤ `.env`

**–í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL –Ω–∞ VPS**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose.yml`:
```bash
docker-compose up -d
```
- –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –Ω–∞–ø—Ä—è–º—É—é –∏ –æ–±–Ω–æ–≤–∏—Ç–µ `.env`

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
npx prisma generate
npx prisma migrate deploy
```

### –®–∞–≥ 5: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```bash
npm run db:seed  # —Å–æ–∑–¥–∞—Å—Ç admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω
```

### –®–∞–≥ 6: –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
npm run build
```

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
```bash
npm start
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º:
```bash
npm install -g pm2
pm2 start npm --name "dom-pivovara" -- start
pm2 save
pm2 startup
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `next.config.js` –¥–ª—è VPS –¥–æ–º–µ–Ω–∞
–û–±–Ω–æ–≤–∏—Ç–µ `next.config.js`:
```javascript
images: {
  domains: ['localhost', 'yourdomain.com', 'via.placeholder.com', ...],
  // –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ remotePatterns –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
}
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `NEXT_PUBLIC_SITE_URL`
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` –µ—Å—Ç—å:
```
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
```
–≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ email-—à–∞–±–ª–æ–Ω–∞—Ö.

### 3. –ü—Ä–æ—Ü–µ—Å—Å –º–µ–Ω–µ–¥–∂–µ—Ä (PM2)
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PM2 –¥–ª—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ —Å–±–æ—è—Ö
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞–º–∏
- –ó–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

### 4. Reverse Proxy (Nginx)
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –∫–∞–∫ reverse proxy –¥–ª—è Next.js:
```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 5. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt –¥–ª—è HTTPS:
```bash
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞: Connection Pool Timeout
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Neon PostgreSQL, —Å–º–æ—Ç—Ä–∏—Ç–µ `NEON_CONNECTION_POOL_FIX.md`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ `public/uploads`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Node.js (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Node.js 18+)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

- [ ] `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] `npm install` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] `npx prisma generate` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] `npm run build` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] `next.config.js` –æ–±–Ω–æ–≤–ª–µ–Ω —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü–∞–ø–∫–∞ `public/uploads` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 3000
- [ ] Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–¥–ª—è HTTPS)

## üìù –†–µ–∑—é–º–µ:

**–ü—Ä–æ–µ–∫—Ç –ú–û–ñ–ï–¢ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ VPS**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç:
1. –°–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ `.env` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma Client
5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
6. –°–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Ä–µ—à–∞–µ–º—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —à–∞–≥–∞–º–∏ –¥–µ–ø–ª–æ—è Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

